# Dify 数据安全与隐私保护指南

数据安全和隐私保护是使用 AI 应用时的关键考量因素。本指南将介绍 Dify 采取的数据安全措施以及如何配置隐私保护设置，帮助您安全地使用 Dify 构建 AI 应用。

## 目录

- [数据安全概述](#数据安全概述)
- [数据处理流程](#数据处理流程)
- [数据加密与存储](#数据加密与存储)
- [隐私设置配置](#隐私设置配置)
- [对话历史管理](#对话历史管理)
- [安全最佳实践](#安全最佳实践)
- [合规性与认证](#合规性与认证)
- [常见问题](#常见问题)

## 数据安全概述

Dify 设计了全面的数据安全架构，保护您的敏感信息：

### 数据安全原则

1. **最小数据原则**：仅收集和处理完成任务所必需的数据
2. **数据隔离**：不同租户的数据严格隔离
3. **端到端加密**：数据传输和存储过程中的加密保护
4. **访问控制**：基于角色的权限管理
5. **数据透明**：清晰的数据处理流程和政策

### 安全架构

Dify 的安全架构包括以下层级：

- **应用层安全**：API 身份验证和授权
- **传输层安全**：TLS/SSL 加密
- **存储层安全**：数据库加密
- **基础设施安全**：云平台安全配置
- **运行时安全**：容器隔离和监控

## 数据处理流程

了解 Dify 如何处理数据有助于您更好地保护隐私：

### 用户数据类型

Dify 处理的主要数据类型包括：

1. **应用配置数据**：应用设置、提示词模板等
2. **用户输入数据**：用户查询和上传的文件
3. **对话历史数据**：用户与 AI 的交互记录
4. **知识库数据**：上传至数据集的文档
5. **日志和分析数据**：用于监控和改进服务

### 数据流向

1. **用户输入 → Dify 服务**：通过加密通道传输
2. **Dify 服务 → 模型提供商**：根据需要发送到 LLM 提供商
3. **模型提供商 → Dify 服务**：接收模型生成内容
4. **Dify 服务 → 用户**：返回处理结果

### 数据保留政策

Dify 遵循以下数据保留策略：

- **云服务**：根据用户选择保留或删除对话历史
- **自托管**：您完全控制数据保留期限
- **日志数据**：最长保留 30 天用于故障排除

## 数据加密与存储

### 传输加密

所有 Dify 服务使用 TLS 1.2+ 加密通信：

- **API 通信**：HTTPS 协议
- **WebSocket 连接**：WSS 协议
- **内部服务通信**：服务间加密

### 存储加密

Dify 采用多层加密保护静态数据：

1. **数据库加密**：敏感字段使用 AES-256 加密
2. **文件加密**：上传文档使用唯一密钥加密
3. **密钥管理**：API 密钥和访问令牌安全存储

### 第三方服务数据处理

当 Dify 与第三方服务（如 LLM 提供商）交互时：

- 仅传输必要的数据（无元数据）
- 遵循第三方的数据处理政策
- 提供选项禁用不符合要求的第三方服务

## 隐私设置配置

### 应用级隐私设置

在应用设置中，您可以配置隐私相关选项：

1. 导航至**应用 > {您的应用} > 设置 > 隐私与安全**
2. 配置以下选项：
   - **对话历史记录**：是否保存及保存时长
   - **敏感信息过滤**：启用/禁用敏感信息检测
   - **数据使用限制**：限制数据用于训练等用途

### 模型提供商隐私设置

配置与模型提供商相关的隐私设置：

1. 导航至**设置 > 模型提供商**
2. 选择模型提供商并点击**编辑**
3. 配置数据处理相关选项：
   - **禁用数据存储**：要求提供商不存储对话数据
   - **禁用数据用于训练**：要求提供商不使用数据进行模型训练

### 系统级隐私设置

对于自托管 Dify，可在系统级配置隐私选项：

1. 编辑 `.env` 文件
2. 配置相关环境变量：
   ```
   # 隐私保护设置
   DISABLE_USAGE_STATISTICS=true       # 禁用匿名使用统计
   DEFAULT_CONVERSATION_RETENTION=30   # 默认对话保留天数
   ENABLE_AUDIT_LOG=true               # 启用审计日志
   ```

## 对话历史管理

### 对话保留设置

控制对话历史的保留策略：

1. 导航至**应用 > {您的应用} > 设置 > 对话管理**
2. 配置以下选项：
   - **保留期限**：设置自动删除的时间（7天/30天/90天/永久）
   - **自动清理**：启用定期自动清理

### 手动管理对话

管理和删除特定对话：

1. 导航至**应用 > {您的应用} > 监控 > 会话**
2. 找到要管理的对话
3. 使用操作菜单：
   - **删除**：永久删除单个对话
   - **导出**：以 JSON 格式导出对话内容

### 批量处理工具

对于大规模对话处理：

1. 使用过滤器选择多个对话
2. 选择批量操作：
   - **批量删除**：删除所有选中对话
   - **批量导出**：导出所有选中对话
   - **更改保留策略**：修改选中对话的保留期限

## 安全最佳实践

### 自托管部署安全

自托管 Dify 时的安全建议：

1. **使用私有网络**：在 VPC 或内部网络中部署
2. **启用防火墙**：限制访问端口和 IP
3. **使用 HTTPS**：配置 SSL 证书
4. **定期更新**：保持系统和 Dify 版本最新
5. **隔离数据库**：数据库服务器与应用服务器分离

### 访问控制最佳实践

保护对 Dify 平台的访问：

1. **强密码策略**：要求复杂密码和定期更改
2. **多因素认证**：启用 MFA（如可用）
3. **最小权限原则**：按需分配最小必要权限
4. **定期审计**：检查用户访问权限和活动
5. **即时撤销**：用户离职时立即撤销权限

### API 安全最佳实践

使用 Dify API 时的安全建议：

1. **轮换 API 密钥**：定期更新 API 密钥
2. **环境隔离**：为不同环境使用不同的 API 密钥
3. **限制 API 调用**：设置速率限制防止滥用
4. **安全存储密钥**：使用密钥管理服务存储 API 密钥
5. **监控异常活动**：设置 API 使用警报

## 合规性与认证

### 数据合规性

Dify 帮助您符合以下数据保护法规：

- **GDPR**（欧盟通用数据保护条例）
- **CCPA**（加州消费者隐私法案）
- **HIPAA**（美国健康保险便携与责任法案，适用于特定配置）
- **中国个人信息保护法**

### 合规性功能

Dify 提供以下功能支持合规要求：

1. **数据访问权**：用户可导出其所有数据
2. **数据删除权**：提供数据删除机制
3. **数据处理记录**：维护详细的数据处理日志
4. **数据处理协议**：明确的数据处理条款
5. **安全影响评估**：提供相关文档

### 第三方认证

Dify 云服务和企业版可能具有以下认证：

- **SOC 2**：安全、可用性和保密性控制
- **ISO 27001**：信息安全管理体系
- **CSA STAR**：云安全联盟认证

*注：具体认证可能随版本变化，请参考官方文档获取最新信息*

## 常见问题

### 如何确保我的敏感数据不被用于模型训练？

1. 在应用设置中禁用"允许用于模型训练"选项
2. 使用支持禁用训练的模型提供商
3. 考虑使用自托管模型或私有部署

### Dify 如何处理多租户隔离？

1. 每个租户拥有独立的数据库架构或实例
2. 应用级别的访问控制确保租户间数据隔离
3. 加密使用租户特定的密钥

### 如何实施数据屏蔽和匿名化？

1. 使用提示词模板中的数据过滤指令
2. 在 API 调用前实施数据屏蔽
3. 使用正则表达式或 NER 模型识别和屏蔽敏感信息

### 如果数据泄露，Dify 会如何处理？

1. 立即通知受影响的用户
2. 提供泄露范围和潜在影响的详细信息
3. 采取措施控制和修复漏洞
4. 根据适用法律法规报告给相关监管机构

### 如何在不牺牲功能的情况下提高安全性？

1. 使用自托管解决方案获得最大控制权
2. 实施细粒度的访问控制
3. 对敏感应用启用高级审计功能
4. 定期安全审查和更新 